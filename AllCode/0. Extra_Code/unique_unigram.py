# -*- coding: utf-8 -*-
"""
Created on Wed Nov 8 18:52:21 2023

@author: admin
"""
import os
import re
import pandas as pd
# Input folder path containing text files
input_folder = r'D:\Malware\worm\api_name_arguments_clean_space'  # Replace with the path to your input folder

# Output folder path to store unigram files in CSV format
output_folder = r'D:\Malware\worm\unique_unigrams'  # Replace with the path to your output folder
os.makedirs(output_folder, exist_ok=True)


# Maximum number of unigrams to generate per file
max_unigrams = 50000

# Check if the input folder exists
if os.path.exists(input_folder):
    # Create the output folder if it doesn't exist
    if not os.path.exists(output_folder):
        os.makedirs(output_folder)

    # Iterate through the files in the input folder
    for filename in os.listdir(input_folder):
        input_file_path = os.path.join(input_folder, filename)

        # Check if it's a file
        if os.path.isfile(input_file_path):
            print(f"Processing '{filename}'...")

            # Read the text from the input file
            with open(input_file_path, 'r', encoding='utf-8') as input_file:
                text = input_file.read()

            # Tokenize the text at line breaks and avoid splitting at special characters
            unigrams = re.split(r'[\r\n]+', text)

            # Limit the number of unigrams to the maximum
            unigrams = unigrams[:max_unigrams]

            # Remove empty lines and duplicates
            unigrams = set(line.strip() for line in unigrams if line.strip())

            # Remove the .txt extension from the filename
            filename_without_extension = os.path.splitext(filename)[0]

            # Construct the output file path in the output folder
            output_csv_file_path = os.path.join(output_folder, f'{filename_without_extension}.csv')

            # Create a DataFrame from the set of unigrams
            df = pd.DataFrame({'Unigram': list(unigrams)})

            # Save the unique unigrams to a CSV file with an escape character
            df.to_csv(output_csv_file_path, index=False, encoding='utf-8', escapechar='\\')

            print(f"Unique Unigrams generated for '{filename}' and saved to '{output_csv_file_path}'.")

else:
    print(f"The input folder '{input_folder}' does not exist.")
