import os
import csv

def compare_csv(file1_path, file2):
    # Extract headers from the single CSV file (file2)
    with open(file2, 'r', encoding='utf-8') as csv_file:
        csv_reader = csv.DictReader(csv_file)
        headers = set(csv_reader.fieldnames)

    # Initialize examples list
    examples = []

    # Iterate through all CSV files in file1_path
    for file1 in os.listdir(file1_path):
        if file1.endswith('.csv'):
            file1_full_path = os.path.join(file1_path, file1)

            # Read the CSV file from file1_path
            with open(file1_full_path, 'r', encoding='utf-8') as csv_file:
                # Skip lines with NUL characters
                lines_file1 = [row for row in csv.reader(line.replace('\0', '') for line in csv_file)]

            # Skip initializing the example if the CSV is empty
            if not lines_file1:
                continue

            # Initialize example as an empty dictionary
            example = {}

            # Compare lines and create examples
            for line1 in lines_file1:
                # Use a set to efficiently check if a line from file1 exists in file2
                line_set = set(line1)
                present_in_file2 = any(line_set.intersection(headers))
                example[f'{",".join(line1)}'] = present_in_file2

            examples.append(example)

    return examples

# Example usage:
file1_path = r'D:\Malware\n_grams\all_unigram_set_50k\adware'
file2_path = r'D:\Malware\n_grams\all_unigram_set_50k\unique_unigram\adware\adware_unigram_unique.csv'

result_examples = compare_csv(file1_path, file2_path)
print(result_examples[:5])
