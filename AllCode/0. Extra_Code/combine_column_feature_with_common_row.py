import pandas as pd

# Define the paths to your CSV files
csv1_path = r'C:\Users\Admin\Downloads\test_csv\Sheet1.csv'
csv2_path = r'C:\Users\Admin\Downloads\test_csv\Sheet3.csv'

# Read CSV files into pandas dataframes
df1 = pd.read_csv(csv1_path)
df2 = pd.read_csv(csv2_path)

# Find common columns dynamically
common_columns = list(set(df1.columns) & set(df2.columns))

# Add zero columns for missing columns in df1
missing_cols_df1 = list(set(df2.columns) - set(df1.columns))
for col in missing_cols_df1:
    df1[col] = 0

# Add zero columns for missing columns in df2
missing_cols_df2 = list(set(df1.columns) - set(df2.columns))
for col in missing_cols_df2:
    df2[col] = 0

# Reorder columns in df2 to match the order of df1
df2 = df2[df1.columns]

# Merge dataframes using the common columns
merged_df = pd.merge(df1, df2, on=common_columns, how='outer', suffixes=('_df1', '_df2'))

# Function to update common rows
def update_common_rows(row):
    for col in common_columns:
        if not pd.isnull(row[col + '_df2']):
            row[col + '_df1'] = row[col + '_df2']
    return row

# Apply the update function to each row
merged_df = merged_df.apply(update_common_rows, axis=1)

# Drop the columns from the second dataframe
merged_df = merged_df.drop([col + '_df2' for col in common_columns], axis=1)

# Save the merged dataframe to a new CSV file
merged_df.to_csv(r'C:\Users\Admin\Downloads\test_csv\Test5.csv', index=False)
