# -*- coding: utf-8 -*-
"""
Created on Thu Dec 21 18:08:46 2023

@author: Bishwajit
"""
import pandas as pd
import os
from tqdm import tqdm  # Import the tqdm module

def compare_csv(file1_path, file2_path):
    file2_df = pd.read_csv(file2_path)
    headers = set(file2_df['Unigram'])
    
    examples = []
    counts_dict = {}

    # Use tqdm to create a progress bar for the loop
    for file1 in tqdm(os.listdir(file1_path), desc="Processing files", unit="file"):
        if file1.endswith('.csv'):
            file1_full_path = os.path.join(file1_path, file1)

            if os.path.getsize(file1_full_path) == 0:
                print(f"Skipping empty file: {file1_full_path}")
                continue

            file1_df = pd.read_csv(file1_full_path, skiprows=1)

            if len(file1_df) <= 1000:
                #print(f"Skipping file with less than or equal to 1000 row: {file1_full_path}")
                continue

            example = {}
            example['name'] = os.path.splitext(os.path.basename(file1_full_path))[0].split('_')[0]
            #os.path.splitext(os.path.basename(file1_full_path))[0]
            example['family'] = os.path.splitext(os.path.basename(file1_full_path))[0].split('_')[1]
            for index, row in file1_df.iterrows():
                row_tuple = tuple(row)
                counts_dict[row_tuple] = counts_dict.get(row_tuple, 0) + 1
                example[f'{",".join(map(str, row))}'] = counts_dict[row_tuple]

            examples.append(example)

    return examples

file1_path = r'C:\sample\virus_unigram_created'
file2_path = r'D:\Malware\unigram_analysis\unique_unigram\unigram\50k\virus.csv'
family_column = 'virus'

result_examples = compare_csv(file1_path, file2_path)
#print(result_examples[:1])

result_df = pd.DataFrame(result_examples)
result_df = result_df.fillna(0)
result_df.to_csv(r'C:\sample\feature_vector\virus_50k.csv', index=False, sep=',')
print("Feature CSV Saved")
