# -*- coding: utf-8 -*-
"""
Created on Mon Dec 25 11:40:48 2023

@author: Bishwajit
"""

import pandas as pd
from tqdm import tqdm
import time

def drop_columns_with_high_zeros(input_csv_path, output_csv_path):
    # Read the CSV file into a DataFrame
    df = pd.read_csv(input_csv_path)

    # Initialize tqdm with the number of columns
    progress_bar = tqdm(total=len(df.columns), desc="Processing Columns")

    # Set the interval for updating progress
    update_interval = 30  # seconds

    # Initialize timer variables
    start_time = time.time()
    last_update_time = start_time

    # Iterate through columns
    for column in df.columns:
        # Calculate the percentage of zeros for the current column
        zeros_percentage = (df[column] == 0).mean()

        # Drop the column if more than 50% zeros
        if zeros_percentage > 0.5:
            df = df.drop(columns=column)
            progress_bar.set_postfix({"Dropped Columns": progress_bar.n - 1})
        progress_bar.update()

        # Check if it's time to update progress
        current_time = time.time()
        if current_time - last_update_time > update_interval:
            progress_bar.close()
            print(f"Processed {progress_bar.n} columns so far. Saving intermediate result...")
            df.to_csv(output_csv_path, index=False)
            last_update_time = current_time
            progress_bar = tqdm(total=len(df.columns) - progress_bar.n, desc="Processing Columns")

    progress_bar.close()

    # Save the final modified DataFrame to a new CSV file
    df.to_csv(output_csv_path, index=False)

# Example usage:
input_csv_path = r"C:\sample\feature_vector\adware.csv"
output_csv_path = r"C:\sample\feature_vector\reduced_feature_vector\adware.csv"
drop_columns_with_high_zeros(input_csv_path, output_csv_path)
